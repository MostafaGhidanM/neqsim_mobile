# Codemagic CI/CD â€“ NeqSim Mobile (this repo is the Flutter app only)
# Repo root = this folder. Docs: https://docs.codemagic.io/yaml-quick-start/building-a-flutter-app

workflows:
  android-workflow:
    name: Android Build
    max_build_duration: 60
    environment:
      flutter: stable
    scripts:
      - name: Set up local.properties
        script: |
          echo "flutter.sdk=${FLUTTER_ROOT:-$HOME/programs/flutter}" > "$CM_BUILD_DIR/android/local.properties"
      - name: Get Flutter packages
        script: |
          cd "$CM_BUILD_DIR"
          flutter pub get
      - name: Flutter analyze
        script: |
          cd "$CM_BUILD_DIR"
          flutter analyze
      - name: Flutter test
        script: |
          cd "$CM_BUILD_DIR"
          flutter test
        ignore_failure: true
      - name: Build Android APK (release)
        script: |
          cd "$CM_BUILD_DIR"
          flutter build apk --release
      - name: Build Android App Bundle (release)
        script: |
          cd "$CM_BUILD_DIR"
          flutter build appbundle --release
    artifacts:
      - build/app/outputs/flutter-apk/*.apk
      - build/app/outputs/bundle/release/*.aab
    publishing:
      scripts:
        - name: Publish build artifacts
          script: |
            echo "APK and AAB built. Download from Artifacts tab."
